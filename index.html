<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Practivio News</title>
  <style>
    :root{--bg:#0b0c10;--card:#121318;--text:#e8eef2;--muted:#9aa4af;--accent:#5eead4;}
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial}
    header{padding:18px 16px;border-bottom:1px solid #1f2430;background:#0f1116;position:sticky;top:0}
    h1{margin:0;font-size:20px}
    main{max-width:900px;margin:28px auto;padding:0 16px}
    .row{display:grid;grid-template-columns:1fr auto;gap:10px;align-items:center}
    .grid{display:grid;gap:14px}
    .card{background:var(--card);border:1px solid #1f2430;border-radius:14px;padding:14px}
    .title{font-weight:600;margin:0 0 6px}
    .muted{color:var(--muted);font-size:13px}
    .tags{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
    .tag{font-size:12px;border:1px solid #243040;padding:2px 8px;border-radius:999px;color:#b8c0cc}
    a{color:var(--accent);text-decoration:none} a:hover{text-decoration:underline}
    .topbar-links a{margin-right:12px}
    .error{color:#ff7b7b}
  </style>
</head>
<body>
  <header class="row">
    <h1>Practivio News</h1>
    <nav class="topbar-links">
      <a href="sora.html">Sora Prompts (private)</a>
      <a href="https://github.com/Practivio/practivio-news" target="_blank" rel="noopener">GitHub</a>
    </nav>
  </header>

  <main>
    <div id="list" class="grid"></div>
    <p id="err" class="error" hidden></p>
  </main>

  <script>
    async function loadIndex() {
      try {
        const res = await fetch('content/index.json', {cache:'no-store'});
        if (!res.ok) throw new Error('HTTP '+res.status);
        const data = await res.json();
        const listEl = document.getElementById('list');
        listEl.innerHTML = '';

        (data.articles || []).forEach(a => {
          const card = document.createElement('article');
          card.className = 'card';
          card.innerHTML = `
            <h3 class="title">${escapeHtml(a.title || 'Untitled')}</h3>
            <div class="muted">
              <span>${a.published_at ? new Date(a.published_at).toLocaleString() : ''}</span>
              &nbsp;·&nbsp;
              <a href="${a.source_url}" target="_blank" rel="noopener">Source</a>
            </div>
            <div class="tags">
              <span class="tag">${a.category || 'center'}</span>
              <a class="tag" href="content/articles/${a.slug}" target="_blank">JSON</a>
            </div>
          `;
          listEl.appendChild(card);
        });

        if (listEl.children.length === 0) {
          document.getElementById('err').hidden = false;
          document.getElementById('err').textContent = 'No articles yet. Run: node scripts/generateNews.js';
        }
      } catch (e) {
        const err = document.getElementById('err');
        err.hidden = false;
        err.textContent = 'Failed to load content/index.json — ' + e.message;
        console.error(e);
      }
    }
    function escapeHtml(s){return s?.replace(/[&<>"']/g,c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c]))||''}
    loadIndex();
  </script>
</body>
</html>
