<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Sora Prompts • Practivio</title>
  <style>
    :root {
      --bg:#0b0c10;
      --card:#121318;
      --text:#e8eef2;
      --muted:#9aa4af;
      --accent:#5eead4;
    }
    body {
      margin:0;
      background:var(--bg);
      color:var(--text);
      font:16px/1.5 system-ui,Segoe UI,Roboto,Helvetica,Arial;
    }
    header {
      padding:18px 16px;
      border-bottom:1px solid #1f2430;
      background:#0f1116;
      position:sticky;
      top:0;
    }
    h1{margin:0;font-size:20px}
    main{max-width:900px;margin:28px auto;padding:0 16px}
    .grid{display:grid;gap:16px}
    .card{
      background:var(--card);
      border:1px solid #1f2430;
      border-radius:14px;
      padding:14px;
    }
    .title{margin:0 0 6px}
    .muted{color:var(--muted);font-size:13px}
    textarea{
      width:100%;
      min-height:180px;
      background:#0f1218;
      color:#e8eef2;
      border:1px solid #243040;
      border-radius:10px;
      padding:10px;
      font-family:ui-monospace,Menlo,Consolas,monospace;
    }
    .row{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0}
    .tag{
      font-size:12px;
      border:1px solid #243040;
      padding:2px 8px;
      border-radius:999px;
      color:#b8c0cc;
    }
    a{color:var(--accent);text-decoration:none}
    .error{color:#ff7b7b}
    .sr{position:absolute;left:-9999px}
    button {
      margin-top:6px;
      padding:6px 10px;
      border:0;
      border-radius:6px;
      background:var(--accent);
      color:#000;
      font-weight:600;
      cursor:pointer;
    }
    button:hover{opacity:0.9}
    .copied {
      color: var(--accent);
      font-size: 13px;
      margin-left: 6px;
    }
  </style>
</head>
<body>
  <header>
    <h1>Sora Prompts <span class="sr">(private)</span></h1>
  </header>

  <main>
    <div class="row">
      <label class="tag">Private view</label>
      <a class="tag" href="./">Back to News</a>
    </div>
    <div id="list" class="grid"></div>
    <p id="err" class="error" hidden></p>
  </main>

  <script>
    async function loadSora() {
      try {
        const res = await fetch('content/sora/index.json', { cache:'no-store' });
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const data = await res.json();
        const listEl = document.getElementById('list');
        listEl.innerHTML = '';

        (data.prompts || []).forEach(item => {
          const card = document.createElement('article');
          card.className = 'card';
          const promptText = buildSoraPrompt(item);

          const copyId = 'copy-' + Math.random().toString(36).slice(2);
          card.innerHTML = `
            <h3 class="title">${escapeHtml(item.title || 'Untitled')}</h3>
            <div class="muted">${new Date(item.created_at).toLocaleString()} · 
              <a href="${item.source_url}" target="_blank" rel="noopener">Source</a>
            </div>
            <div class="row">
              <span class="tag">${item.category || 'general'}</span>
              <span class="tag">neutral voiceover</span>
            </div>
            <textarea id="${copyId}" readonly>${promptText}</textarea>
            <button onclick="copyPrompt('${copyId}', this)">Copy Prompt</button>
          `;
          listEl.appendChild(card);
        });

        if (listEl.children.length === 0) {
          document.getElementById('err').hidden = false;
          document.getElementById('err').textContent = 'No Sora prompts yet.';
        }
      } catch(e) {
        const err = document.getElementById('err');
        err.hidden = false;
        err.textContent = 'Failed to load content/sora/index.json — ' + e.message;
        console.error(e);
      }
    }

    function copyPrompt(id, btn) {
      const textarea = document.getElementById(id);
      navigator.clipboard.writeText(textarea.value).then(() => {
        btn.textContent = 'Copied!';
        btn.disabled = true;
        setTimeout(() => {
          btn.textContent = 'Copy Prompt';
          btn.disabled = false;
        }, 1500);
      });
    }

    function buildSoraPrompt(item){
      const h = item?.neutral?.headline || item?.title || 'News update';
      const body = item?.neutral?.body_html?.replace(/<[^>]+>/g,' ') || item?.summary || '';
      const vox = '@lee627';
      const maxSec = 'under 10 seconds';

      return [
        `voice ${vox}`,
        `narration neutral concise ${maxSec}`,
        `scene: overlay headlines, quick cuts of relevant b-roll, clean lower thirds`,
        `script: ${h}. ${body}`,
        `cta: invite comments at end, no platform mention, no profanity`,
      ].join('\n');
    }

    function escapeHtml(s){
      return s?.replace(/[&<>"']/g, c => ({
        '&':'&amp;',
        '<':'&lt;',
        '>':'&gt;',
        '"':'&quot;',
        "'":'&#39;'
      }[c])) || '';
    }

    loadSora();
  </script>
</body>
</html>
